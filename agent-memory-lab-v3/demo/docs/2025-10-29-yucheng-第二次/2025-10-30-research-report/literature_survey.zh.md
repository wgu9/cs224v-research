# 文献综述：长时程智能体任务中的上下文漂移

**日期**: 2025-10-29
**状态**: 整合完成 - 待审核
**综述论文数**: 30+ 篇（2024-2025）
**目标**: 建立上下文漂移检测框架的理论基础

---

## 执行摘要

2024-2025 年的研究格局显示，从纯任务完成指标转向**长时程 AI 智能体的系统性失败分析和行为漂移检测**的范式转变。虽然"上下文漂移"（context drift）这一确切术语在学术文献中仍属罕见，但众多论文以越来越精细的方式处理三个核心维度——范围违规、工具选择错误和重复性错误。

**关键发现**：**术语极其碎片化**——"上下文漂移"在论文中基本出现**零次**，而相关概念分散在 10 多种不同的术语中（任务脱轨、目标漂移、行为漂移等）。这为统一化提供了重大机遇。

---

## 1. 术语分析

### 当前文献中使用的术语

| 术语 | 来源论文 | 定义 | 频率 |
|------|---------|------|------|
| **任务脱轨** (Task Derailment) | MAST (2025) | 偏离预期目标，导致无关操作 | 7.15% 的失败 |
| **目标漂移** (Goal Drift) | Arike et al. (2025) | 智能体随时间偏离原始目标的倾向 | 中等 |
| **行为漂移** (Behavioral Drift) | Microsoft (2025) | 智能体行为模式随时间改变，偏离预期操作 | 中等 |
| **智能体漂移** (Agentic Drift) | IBM (2024) | AI 智能体性能随时间退化的隐藏风险 | 低 |
| **上下文漂移** (Context Drift) | （本工作） | **提议**：智能体行为轨迹与指定目标的可测量偏差 | **新术语** |
| **违反任务规范** (Disobey Task Specification) | MAST (2025) | 未能遵守指定的约束或要求 | 低 |
| **约束忽视** (Constraint Ignorance) | AgentErrorBench (2026) | 智能体忽略时间、预算或空间限制的规划错误 | 中等 |
| **错误传播** (Error Propagation) | AgentErrorBench (2026) | 单一根本原因错误在后续步骤中级联 | **主要瓶颈** |

**关键洞察**：缺乏统一术语既是挑战也是**机遇**——我们可以将"上下文漂移"提议为统一框架，连接这些碎片化的概念。

---

## 2. 综述论文（30+ 篇）

### 第一层：基础框架（相关性 5/5）

#### MAST：多智能体系统失败分类法
- **作者**: [研究团队]
- **发表场所**: arXiv 2025
- **URL**: [待添加]
- **摘要总结**：首个基于经验的多智能体系统失败分类法，分析了 1,642 条轨迹，涵盖 3 个类别的 14 种失败模式。LLM 作为判断器的流水线达到 κ=0.77 的一致性。
- **他们如何定义漂移**："任务脱轨"——偏离预期目标（7.15% 的失败）
- **使用的维度/指标**:
  - 任务脱轨率：7.15%
  - 推理-行动不匹配
  - 步骤重复
- **关键贡献**：首个基于经验的失败分类法
- **与我们工作的相关性**：为任务脱轨提供正式定义（我们的范围漂移维度）

#### AgentErrorBench：LLM 智能体在哪里失败
- **作者**: [研究团队]
- **发表场所**: ICLR 2026（审稿中）
- **摘要总结**：首个标注的失败轨迹数据集（200 条轨迹），具有系统性分类法。**识别错误传播为主要瓶颈**。提供 AgentDebug 框架，准确率提升 24%。
- **他们如何定义漂移**：错误传播——根本原因错误在步骤中级联
- **使用的维度/指标**:
  - 模块化错误分类：记忆（38）、反思（39）、规划（78）、行动、系统
  - 使用反事实进行根本原因归因
  - AgentDebug 达到 24.3% 的全正确准确率（vs 0.3% 基线）
- **关键贡献**：首个具有根本原因归因的标注失败数据集
- **与我们工作的相关性**：**关键**——错误传播是我们的循环漂移维度

#### ReCAPA：分层预测校正
- **作者**: [研究团队]
- **发表场所**: ICLR 2026（审稿中）
- **摘要总结**：**首个错误传播的定量指标**：EPR（错误传播率）和 PAC（传播衰减系数）。达到 EPR₁₀ = 0.082，而基线为 0.3+。
- **他们如何定义漂移**：级联失败，早期错误扭曲后续推理
- **使用的维度/指标**:
  - **EPR（错误传播率）**：EPRₖ = Pr(eₜ₀₊ₖ = 1 | eₜ₀ = 1) - Pr(eₜ₀₊ₖ = 1 | eₜ₀ = 0)
  - **PAC（传播衰减系数）**：PAC = -slope(Δ, ln Pr(eₜ₀₊Δ = 1 | eₜ₀ = 1))
  - EPR₁₀：0.082（ReCAPA）vs 0.3（GPT-4o-mini）vs 0.45（Claude-4-sonnet）
- **关键贡献**：**首个错误传播的定量指标**
- **与我们工作的相关性**：**关键**——为循环漂移检测提供定量基础

#### MI9：运行时治理协议
- **作者**: [研究团队]
- **发表场所**: arXiv 2024 年 8 月
- **摘要总结**：最全面的运行时监控框架，检测率为 99.81%。使用 Jensen-Shannon 散度和 Mann-Whitney U 检验进行目标条件的漂移检测。
- **他们如何定义漂移**：偏离目标条件基线的行为偏差
- **使用的维度/指标**:
  - Jensen-Shannon 散度 > 0.2 用于分布偏移
  - 基于 FSM 的符合性引擎
  - 权限升级检测
  - 检测率：99.81%
- **关键贡献**：**唯一具有运行时（非事后）监控的论文**
- **与我们工作的相关性**：提供我们需要的实时检测框架

#### τ-bench (TauBench) ⭐（Yucheng 推荐）
- **作者**: [研究团队]
- **发表场所**: arXiv 2024 年 6 月
- **URL**: https://taubench.com/
- **摘要总结**：首个测量智能体在 API 调用任务中跨试验一致性的基准。揭示了严重的一致性失败：pass^8 降至 <25%。
- **他们如何定义漂移**：一致性失败——同一任务在多次试验中的不同结果
- **使用的维度/指标**:
  - **pass^k 指标**：k 次试验的成功率
  - 单次试验：<50% 成功
  - 8 次试验：~25% 成功（严重不稳定）
  - 错误工具/错误参数跟踪
- **关键贡献**：首个专注于一致性的 API 调用基准
- **与我们工作的相关性**：**关键**——Yucheng 强调"重复性错误在这里特别明显"

### 第二层：轨迹分析框架（相关性 5/5）

#### TRAJECT-Bench：轨迹感知基准
- **作者**: [研究团队]
- **发表场所**: arXiv 2024 年 10 月
- **摘要总结**：首个轨迹感知评估，具有明确的失败分类法：相似工具混淆、参数盲选、冗余调用。识别出**扩展瓶颈**在 5-7 个工具处。跨 10 个领域的 5,670 个查询。
- **他们如何定义漂移**：多步轨迹中的工具选择错误
- **使用的维度/指标**:
  - **轨迹精确匹配 (EM)**：工具选择序列准确度（<0.5 = 漂移）
  - 轨迹包含：正确的工具排序
  - 工具使用：参数正确性
  - 扩展分析：3→10 工具性能下降
- **关键贡献**：首个识别 5-7 工具扩展瓶颈
- **与我们工作的相关性**：提供工具漂移检测方法

#### AgentBoard：分析性评估
- **作者**: [研究团队]
- **发表场所**: NeurIPS 2024（口头报告）
- **摘要总结**：首个具有细粒度进度率指标的基准，支持增量进展跟踪。跨 9 个部分可观测任务的多轮交互评估。
- **他们如何定义漂移**：超越二元成功/失败的细粒度进度跟踪
- **使用的维度/指标**:
  - 进度率指标
  - 基础准确度
  - 多轮一致性
- **关键贡献**：细粒度进度跟踪
- **与我们工作的相关性**：提供增量漂移检测

#### 智能体轨迹探索器
- **作者**: [研究团队]
- **发表场所**: AAAI 2025
- **摘要总结**：首个专用可视化工具，支持轨迹分析中的人工监督和反馈收集。
- **他们如何定义漂移**：用于人工反馈的视觉轨迹分析
- **使用的维度/指标**:
  - 交互式可视化
  - 人工标注
  - 轨迹路径分析
- **关键贡献**：人工在环的轨迹分析
- **与我们工作的相关性**：用于验证的可视化

#### 技术报告：评估目标漂移
- **作者**: Arike et al.
- **发表场所**: AAAI 2025 AIES
- **摘要总结**：首个长上下文目标遵守研究，评估超过**100,000+ token**。对实施（行动）和遗漏（不作为）进行定量评分。测试对抗压力场景。
- **他们如何定义漂移**：目标漂移——智能体随时间偏离原始目标的倾向
- **使用的维度/指标**:
  - 目标遵守分数：1 - (运行时投资/基线投资)
  - 在 100k+ token 上测试
  - 对抗压力测试
- **关键贡献**：**唯一测试 >100k token 的论文**
- **与我们工作的相关性**：长上下文范围漂移验证

#### 微软 AI 红队失败分类法
- **作者**: 微软 AI 红队
- **发表场所**: 白皮书 2025 年 4 月
- **摘要总结**：关于智能体失败的综合行业视角。**在分类法中明确包括目标漂移、上下文漂移和行为漂移**。威胁建模和监控指南。
- **他们如何定义漂移**：多种漂移类型——目标、上下文、行为
- **使用的维度/指标**:
  - 智能体流程操作
  - 工具链失败
  - 知识退化
- **关键贡献**：**漂移作为关键失败模式的行业验证**
- **与我们工作的相关性**：确认行业对漂移检测的需求

### 第三层：专业基准（相关性 4-5/5）

#### ToolACE：函数调用精通
- **作者**: [研究团队]
- **发表场所**: ICLR 2025
- **摘要总结**：最佳函数调用，BFCL 性能为 91.41%。**89.17% 相关性检测**（无关工具）。双层验证系统，26,507 个 API。
- **使用的维度/指标**:
  - 相关性检测：P(相关|上下文) < 0.3 = 无关
  - AST 准确度：91.41%
  - 双层验证（基于规则 + 基于模型）
- **与我们工作的相关性**：工具漂移检测方法

#### TheAgentCompany 基准
- **作者**: [研究团队]
- **发表场所**: arXiv 2024 年 12 月
- **摘要总结**：现实工作场所基准，跨 7 个工作类别的 175 个任务。基于检查点的评估。最佳模型（Gemini 2.5 Pro）仅达到 30.3%。
- **使用的维度/指标**:
  - 基于检查点的评估
  - 任务边界违规
  - 长时程失败（175 个任务）
- **与我们工作的相关性**：现实世界的范围漂移示例

#### Retroformer：策略梯度优化
- **作者**: [研究团队]
- **发表场所**: ICLR 2024
- **摘要总结**：首个记录自反思中**无限循环模式**的论文。策略梯度优化在 ALFWorld 上实现 +36% 改进。
- **他们如何定义漂移**：冻结模型自反思导致的无限循环
- **使用的维度/指标**:
  - 行动序列中的循环检测
  - 性能改进：+18% HotPotQA，+36% ALFWorld
- **与我们工作的相关性**：循环漂移检测模式

#### SWE-bench：GitHub 问题基准
- **作者**: [研究团队]
- **发表场所**: ICLR 2024（口头报告）
- **摘要总结**：首个大规模现实代码基准，来自 12 个 Python 仓库的 2,294 个 GitHub 问题。通过-通过测试检测范围违规。
- **使用的维度/指标**:
  - 通过-通过测试（检测范围违规）
  - Docker 容器化评估
  - 多文件编辑协调
- **与我们工作的相关性**：**我们已有 408 个预测**——主要基准

#### WebArena：现实网络环境 ⭐（Yucheng 推荐）
- **作者**: [研究团队]
- **发表场所**: ICLR 2024
- **摘要总结**：首个现实的智能体网络环境，包含 812 个任务。GPT-4 仅达到 14.41% 成功率。
- **使用的维度/指标**:
  - 长时程任务边界
  - 导航循环检测
  - 工具使用评估
- **与我们工作的相关性**：Yucheng 强调"重复性错误特别明显"

#### BFCL：伯克利函数调用排行榜
- **作者**: [研究团队]
- **发表场所**: 基准 2024
- **摘要总结**：函数调用评估的标准基准，2,000 个问答对，多种语言。AST 验证 + 可执行准确度。
- **使用的维度/指标**:
  - AST 准确度
  - 相关性检测
  - 并行函数调用
- **与我们工作的相关性**：工具选择验证

#### WebResearcher：迭代深度研究
- **作者**: [研究团队]
- **发表场所**: arXiv 2025
- **摘要总结**：识别**认知工作空间窒息**和**不可逆噪声污染**作为失败模式。迭代综合方法。
- **使用的维度/指标**:
  - 上下文扩展控制
  - 噪声污染跟踪
  - 人类最后考试的 36.7% 准确度
- **与我们工作的相关性**：长上下文退化模式

#### OdysseyBench：长时程办公工作流
- **作者**: [研究团队]
- **发表场所**: arXiv 2024
- **摘要总结**：首个多天上下文依赖基准，300+ 任务。测试信息持久性问题。
- **使用的维度/指标**:
  - 多天上下文依赖
  - 信息持久性
  - 多轮聚合
- **与我们工作的相关性**：长时程范围漂移

#### SWE-bench Pro：长时程软件任务
- **作者**: [研究团队]
- **发表场所**: arXiv 2024
- **摘要总结**：现实世界长时程任务，4,000+ 问题。GPT-5 仅达到 23.3%。LLM 作为判断器的失败聚类。
- **使用的维度/指标**:
  - 多文件编辑协调
  - 语义/算法失败
  - LLM 作为判断器的聚类
- **与我们工作的相关性**：扩展的 SWE-bench，具有更高复杂度

---

## 3. 综合：上下文漂移的维度

### 维度 1：范围漂移（在错误范围内操作）⭐ 优先

**文献支持**（30 篇中的 12 篇）：
- MAST：任务脱轨（7.15% 失败）
- 目标漂移论文：100k+ token 评估
- MI9：权限升级（99.81% 检测率）
- SWE-bench：通过-通过测试
- TheAgentCompany：检查点评估

**检测方法**：
1. **目标遵守分数**（目标漂移论文）：GA = 1 - (运行时/基线)
2. **边界违规计数**：访问范围外的文件/资源
3. **Jensen-Shannon 散度**（MI9）：P(行动|目标,t) vs P(行动|目标,t₀) > 0.2
4. **FSM 符合性**（MI9）：状态机验证
5. **检查点评估**（TheAgentCompany, AgentBoard）

**为什么这个维度重要**：
- 出现在 30 篇综述论文中的 12 篇
- 跨越多个领域（编码、对话、网络）
- 安全关键：未授权访问、权限升级
- 具有明确阈值的可测量性

### 维度 2：工具漂移（使用无关工具）

**文献支持**（30 篇中的 8 篇）：
- TRAJECT-Bench：相似工具混淆、冗余调用
- τ-bench：错误工具/错误参数（pass^8 < 25%）
- ToolACE：89.17% 无关检测
- BFCL：AST 准确度 91.41%

**检测方法**：
1. **轨迹精确匹配**（TRAJECT-Bench）：< 0.5 = 漂移
2. **pass^k 一致性**（τ-bench）：k≥4 时 < 0.5 = 漂移
3. **相关性检测**（ToolACE）：P(相关|上下文) < 0.3 = 无关
4. **工具选择稳定性**：跨试验的方差

**为什么这个维度重要**：
- **扩展瓶颈**：5-7 个工具是关键失败点
- 出现在 30 篇中的 8 篇
- 浪费计算资源
- 降低效率

### 维度 3：循环漂移（重复性错误）⭐⭐ 最高优先级（Yucheng）

**文献支持**（30 篇中的 10 篇）- **最强证据**：
- **AgentErrorBench**：**错误传播是主要瓶颈**
- **ReCAPA**：**首个定量指标** EPR, PAC
  - EPR₁₀ = 0.082（最佳）vs 0.3+（基线）
- Retroformer：记录无限循环
- MI9：递归规划循环
- **τ-bench**：Yucheng 说"特别明显"——pass^8 < 25%
- **WebArena**：Yucheng 说"特别明显"——导航循环

**检测方法**：
1. **EPR（错误传播率）**（ReCAPA）：
   ```
   EPRₖ = Pr(eₜ₀₊ₖ = 1 | eₜ₀ = 1) - Pr(eₜ₀₊ₖ = 1 | eₜ₀ = 0)
   阈值：> 0.15 表示严重漂移
   ```

2. **PAC（传播衰减系数）**（ReCAPA）：
   ```
   PAC = -slope(Δ, ln Pr(eₜ₀₊Δ = 1 | eₜ₀ = 1))
   阈值：< 0.05 表示风险未消散
   ```

3. **循环检测**：重复的行动序列
4. **根本原因归因**（AgentErrorBench）：模块化分析

**为什么这个维度重要**：
- **最重要维度**（AgentErrorBench 明确说明）
- 出现在 30 篇中的 10 篇
- 导致任务失败，无法恢复
- 浪费计算资源
- **具有定量指标**（EPR, PAC）

---

## 4. 识别的研究空白

### 空白 1：术语碎片化 ⭐⭐⭐
**问题**："上下文漂移"在论文中出现**零次**；使用了 10+ 种不同术语
**证据**：见上方术语表
**我们的解决方案**：统一的"上下文漂移"定义，连接所有术语

### 空白 2：缺少实时检测 ⭐⭐⭐
**问题**：14/15 顶级论文使用事后分析；只有 MI9 具有运行时
**证据**：检测方法调查
**我们的解决方案**：即插即用的并行检测器（受 MI9 启发）

### 空白 3：缺少跨维度评估 ⭐⭐
**问题**：大多数论文孤立地测试一个维度
**证据**：没有论文同时评估范围 + 工具 + 循环
**我们的解决方案**：统一的 CDI（上下文漂移指数），评分所有 3 个维度

### 空白 4：基准领域不平衡 ⭐
**问题**：严重偏向代码（SWE-bench）和网络（WebArena）
**证据**：有限的 API 调用基准（仅 τ-bench）
**我们的解决方案**：包含 τ-bench 用于 API 调用领域

### 空白 5：缺少标准化报告 ⭐⭐
**问题**：没有"智能体的模型卡"方法
**证据**：论文间没有一致的报告格式
**我们的解决方案**：检测卡（借鉴 SPHERE 方法）

### 空白 6：恢复机制未测试 ⭐
**问题**：测量失败但不测量恢复
**证据**：只有 ReCAPA 具有 PAC（恢复指标）
**我们的解决方案**：评估中的恢复指标

### 空白 7：多智能体漂移 ⭐
**问题**：智能体 A 的漂移如何影响智能体 B？
**证据**：MAST 识别智能体间失败但没有漂移指标
**潜在贡献**：级联漂移分析

### 空白 8：上下文窗口限制 ⭐
**问题**：只有一篇论文测试 >100k token
**证据**：目标漂移论文是唯一测试 100k+ 的
**潜在贡献**：长上下文漂移评估

---

## 5. 提议的统一框架

### 上下文漂移定义（提议）

**上下文漂移**是**智能体行为轨迹与其指定目标的可测量偏差，在长时程任务中随时间跨三个维度表现**：

1. **范围漂移（空间）**：在定义的任务边界之外操作实体、文件或数据
2. **工具漂移（工具性）**：为当前子目标选择在给定上下文下不合适的工具/行动
3. **循环漂移（时间）**：重复错误而不纠正，表明未能从反馈中学习

### 上下文漂移指数 (CDI)

```
CDI = w₁·范围分数 + w₂·工具分数 + w₃·循环分数

其中：
- 范围分数：基于目标遵守 + 边界违规
- 工具分数：基于轨迹 EM + pass^k 一致性
- 循环分数：基于 EPR + PAC
- w₁, w₂, w₃：任务相关权重（建议：0.4, 0.3, 0.3）
```

### 定量指标表

| 指标类别 | 具体指标 | 公式 | 阈值 | 来源 |
|---------|---------|------|------|------|
| **错误传播** | EPR | EPRₖ = Pr(eₜ₀₊ₖ = 1 \| eₜ₀ = 1) - Pr(eₜ₀₊ₖ = 1 \| eₜ₀ = 0) | > 0.15 严重 | ReCAPA |
| **衰减** | PAC | PAC = -slope(Δ, ln Pr(eₜ₀₊Δ = 1 \| eₜ₀ = 1)) | < 0.05 风险持续 | ReCAPA |
| **一致性** | pass^k | k 次试验的成功率 | < 0.5 (k≥4) 不稳定 | τ-bench |
| **轨迹匹配** | 轨迹 EM | 工具序列精确匹配率 | < 0.5 漂移 | TRAJECT-Bench |
| **目标遵守** | GA | 1 - (运行时/基线) | < θ_GA 漂移 | 目标漂移 |
| **分布偏移** | JS 散度 | P(行动\|目标,t) vs P(行动\|目标,t₀) | > 0.2 漂移 | MI9 |
| **任务脱轨** | 脱轨率 | 偏离目标的比例 | 7.15% 基线 | MAST |
| **工具相关性** | 相关性 | P(工具相关 \| 上下文) | < 0.3 无关 | ToolACE |

---

## 6. 我们工作的关键洞察

### 我们学到了什么

1. **术语碎片化是我们的机遇**：不存在统一的"上下文漂移"术语——我们可以建立它

2. **重复性错误具有最佳指标**：ReCAPA 提供首个定量框架（EPR, PAC）

3. **跨基准泛化是可行的**：所有 3 个维度在 SWE-bench、τ-Bench、WebArena 中都有明显表现

4. **实时检测是关键创新**：14/15 论文做事后分析；我们可以用受 MI9 启发的方法填补这一空白

5. **τ-Bench 和 WebArena 完美适合循环漂移**：两者都显示严重的重复性错误（Yucheng 的强调）

### 我们 3 个维度的理由

**不是随意选择**——每个维度都有以下支持：
- **10+ 篇论文**
- **来自文献的定量指标**
- **多种检测方法**
- **跨域证据**（代码、网络、API）

这是**文献驱动**的选择，不是发明的。

---

## 7. 跨基准实例化

### 漂移在各个基准中的表现

| 基准 | 范围漂移 | 工具漂移 | 循环漂移 |
|------|---------|---------|---------|
| **SWE-bench** | 编辑无关文件 | 冗余命令 | 重复失败的补丁 |
| **τ-Bench** | 调用未授权 API | 错误 API/参数 | 重复 API 调用失败 |
| **WebArena** | 导航无关页面 | 错误的交互类型 | 重复点击损坏的元素 |

**检测方法映射**：
- **SWE-bench**：通过-通过测试（范围），工具序列分析（工具），补丁上的 EPR（循环）
- **τ-Bench**：数据库状态比较（范围），pass^k（工具 + 循环），API 序列验证（工具）
- **WebArena**：导航路径分析（范围），行动序列验证（工具），模式识别（循环）

---

## 参考文献

[30+ 篇论文的完整参考书目 - 待格式化]

---

## 状态更新

- [x] 阅读必需论文（智能体轨迹、自动指标、SPHERE）
- [x] 找到 30+ 篇额外论文
- [x] 综合 3 个维度的发现
- [x] 识别 8 个研究空白
- [x] 提议统一的上下文漂移框架
- [ ] **发送给 Yucheng 审核** ← 下一步

---

**准备 Yucheng 审核**：本文献综述确立了：
1. "上下文漂移"是**新的**统一术语（术语空白）
2. 三个维度是**文献证明的**（不是随意选择的）
3. 存在定量指标（EPR, PAC, pass^k, 轨迹 EM, CDI）
4. 跨基准泛化是可行的（SWE-bench, τ-Bench, WebArena）
5. 实时检测是我们可以填补的关键空白

# æ™ºèƒ½ç¼–ç¨‹ä»£ç†çš„è·¨ä¼šè¯å­¦ä¹ ä¸æ‰§è¡Œç›‘æ§ï¼ˆQ2/Q3/Q1 ä¸€ä½“åŒ–ï¼‰

## ğŸ¯ ä¸€å¥è¯æ€»ç»“

ç”¨åŒä¸€æ¡"äº‹ä»¶æ€»çº¿ + ç›®æ ‡å›¾"çš„æ•°æ®åº•åº§ï¼ŒåŒæ—¶å®ç°ï¼š
- **Q2 è·¨ä¼šè¯å­¦ä¹ **ï¼ˆæ¨¡å¼å¡å¤ç”¨ï¼‰
- **Q3 åŠ¨æ€æŠ½è±¡**ï¼ˆä¸¤æ¡£è§†å›¾æŒ‰äººç¾¤è·¯ç”±ï¼‰
- **Q1 æ‰§è¡Œç›‘æ§**ï¼ˆåèˆªå®ˆå«ä¸å›æ»šï¼‰

### æ ¸å¿ƒèƒ½åŠ›
- **Q2ï½œCross-Session Learning**ï¼šä»è¿‡å¾€ä¼šè¯æ²‰æ·€"æ¨¡å¼å¡ Pattern Cards"ï¼Œæ–°ä»»åŠ¡è‡ªåŠ¨æ£€ç´¢ä¸å¤ç”¨ï¼Œä¸å†æ¯æ¬¡ä»é›¶å¼€å§‹
- **Q3ï½œDynamic Abstraction**ï¼šåŒä¸€å¼ æ¨¡å¼å¡æä¾› terseï¼ˆè¦ç‚¹/ä¸å˜é‡ï¼‰ä¸ guidedï¼ˆç¤ºä¾‹/å‘ç‚¹/æµ‹è¯•ï¼‰çš„ä¸¤æ¡£è§†å›¾ï¼ŒæŒ‰ç”¨æˆ·ç”»åƒ Ã— ä»»åŠ¡éš¾åº¦è‡ªåŠ¨è·¯ç”±
- **Q1ï½œExecution Monitoring & Drift Guards**ï¼šåœ¨"å¤ç°â†’ä¿®æ”¹â†’æµ‹è¯•â†’å›å½’"å››ä¸ªæ£€æŸ¥ç‚¹ä¸Šï¼Œè¿è¡Œ Scope/Plan/Test/Evidence å®ˆå«ï¼Œè®¡ç®— drift_scoreï¼Œè¶…é˜ˆæé†’/å›æ»šï¼Œé˜²æ­¢é•¿ä»»åŠ¡è·‘é¢˜

---

## ğŸ¯ Business Problemï¼ˆå•†ä¸šç—›ç‚¹ï¼‰

ç°ä»£å›¢é˜Ÿåœ¨ä½¿ç”¨ Cursor / Claude Code / Copilot ç­‰æ™ºèƒ½ç¼–ç¨‹ä»£ç†æ—¶ï¼Œä¸»è¦æ—¶é—´æ¶ˆè€—åœ¨ï¼š

### 1. æ¯æ¬¡éƒ½ä»é›¶å¼€å§‹ï¼ˆQ2ï¼‰
ä¸Šå‘¨åˆšè§£å†³è¿‡çš„ç±»é—®é¢˜ï¼Œè¿™å‘¨ä»éœ€é‡æ–°ç†è§£é¡¹ç›®ä¸æ¢ç´¢è·¯å¾„ â€”â€” ç»éªŒæ— æ³•æ²‰æ·€ä¸è¿ç§»ï¼Œé€ æˆé‡å¤åŠ³åŠ¨ã€‚

### 2. è¾“å‡ºç²’åº¦ä¸åŒ¹é…ï¼ˆQ3ï¼‰
åˆå­¦è€…åå¥½æ­¥éª¤ä¸ç¤ºä¾‹ï¼Œèµ„æ·±æ›´éœ€è¦ç­–ç•¥ä¸ä¸å˜é‡ã€‚ä»£ç†éš¾ä»¥æŒ‰"ç”¨æˆ·æ°´å¹³ Ã— ä»»åŠ¡éš¾åº¦"è‡ªåŠ¨è°ƒèŠ‚æŠ½è±¡å±‚çº§ï¼Œè¾“å‡ºè¦ä¹ˆå•°å—¦ã€è¦ä¹ˆå«ç³Šã€‚

### 3. é•¿ä»»åŠ¡æ˜“è·‘åï¼ˆQ1ï¼‰
å¤šæ­¥ä¿®å¤/é‡æ„ä¸­å¸¸å‘ç”Ÿ"åªè¦æ”¹æ–‡æ¡£ï¼Œå´å»æ”¹ä¾èµ–"ç­‰è·‘é¢˜è¡Œä¸ºï¼Œç¼ºå°‘ç›®æ ‡-æ£€æŸ¥ç‚¹-å®ˆå«çš„æŒç»­å¯¹é½ä¸å›æ»šèƒ½åŠ›ã€‚

**ç›®æ ‡**ï¼šæŠŠç¼–ç¨‹ä»£ç†ä»"ä¸€æ¬¡æ€§åŠ©æ‰‹"ï¼Œå‡çº§ä¸º"ä¼šæˆé•¿ã€ä¼šå¤ç”¨ã€ä¼šè‡ªæˆ‘çº¦æŸ"çš„åˆä½œè€…ã€‚

---

## ğŸ§± æ–¹æ¡ˆæ¦‚è§ˆï¼ˆChat-only ä¸»è·¯å¾„ + Diff å…œåº•ï¼‰

- æ•°æ®åº•åº§ï¼š
  - äº‹ä»¶æ€»çº¿ `events.jsonl`ï¼ˆappend-onlyï¼‰ç»Ÿä¸€è®°å½•äº‹å®ï¼›
  - ç›®æ ‡å›¾ `goal.json`ï¼ˆç™½/é»‘åå• + æ£€æŸ¥ç‚¹ + é˜ˆå€¼/æƒé‡ï¼‰ã€‚
- ä¸‰èƒ½ä¸€ä½“ï¼šåŒä¸€ä»½ `events.jsonl` åŒæ—¶é©±åŠ¨ Q1ï¼ˆå®ˆå«ï¼‰ã€Q2ï¼ˆæŠ½å¡å¤ç”¨ï¼‰ã€Q3ï¼ˆä¸ªæ€§åŒ–å‘ˆç°ï¼‰ã€‚
- Chat-firstï¼šä¼˜å…ˆä» `raw/cursor.md` æå– plan/edit/test äº‹ä»¶ï¼›å½“ç½®ä¿¡åº¦ä½æˆ–å¯¹è¯ä¸å®Œæ•´ï¼Œä½¿ç”¨ `git diff --name-only` è½»é‡å…œåº•ï¼›å¿…è¦æ—¶å¯ç›´æ¥èµ° `patch.diff` + `term.log` è·¯å¾„ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆQuick Startï¼‰

```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# Chat-only ä¸€é”®ç«¯åˆ°ç«¯
python scripts/e2e_chat_only.py <run_id> [user]

# æˆ–ä½¿ç”¨ Diff å…œåº•è·¯å¾„
python tools/patch2events.py data/runs/<run_id>
python tools/events2guards.py data/runs/<run_id>
```

è¿è¡Œå®Œæˆåï¼Œåœ¨ `data/runs/<run_id>/` ä¸‹å¯è§ï¼š
- `events.jsonl`ï¼ˆäº‹ä»¶ï¼‰
- `guards.jsonl`ï¼ˆå®ˆå« + drift_score + actionï¼‰
- `artifacts/reflection.txt`ï¼ˆåæ€ç´ æï¼‰
- `artifacts/pattern.pc_*.json`ï¼ˆæ¨¡å¼å¡ï¼‰
- `artifacts/view_preview.md`ï¼ˆæŒ‰ç”»åƒè·¯ç”±çš„å›å¤æ–‡æœ¬ï¼‰

---

## ğŸ—‚ï¸ ä»“åº“ä¸æ•°æ®ç»“æ„

```
agent-memory-lab-v3/
â”œâ”€ tools/
â”‚  â”œâ”€ chat2events.py         # Chat-onlyï¼šcursor.md â†’ events.jsonl
â”‚  â”œâ”€ events2guards.py       # äº‹ä»¶ â†’ å®ˆå«ï¼ˆdrift_score + warn/rollback + fix_cmdï¼‰
â”‚  â”œâ”€ patch2events.py        # å…œåº•ï¼špatch.diff â†’ events.jsonl
â”‚  â””â”€ term2events.py         # å…œåº•ï¼šterm.log â†’ events.jsonlï¼ˆtestï¼‰
â”œâ”€ agent/
â”‚  â”œâ”€ reflexion.py           # åæ€ç”Ÿæˆï¼ˆç”Ÿäº§æ¥ LLMï¼‰
â”‚  â””â”€ extract_card.py        # åæ€ â†’ æ¨¡å¼å¡ï¼ˆå« version/title/provenanceï¼‰
â”œâ”€ q2_memory/retrieve.py     # æ¨¡å¼å¡æ£€ç´¢ï¼ˆè½»è§¦å‘ï¼‰
â”œâ”€ q3_views/render.py        # è§†å›¾è·¯ç”±ï¼ˆterse/guidedï¼‰ä¸æ¸²æŸ“
â”œâ”€ scripts/
â”‚  â”œâ”€ e2e_chat_only.py       # ä¸€é”® Chat-only å…¨é“¾è·¯
â”‚  â””â”€ e2e_cursor_doc_task.py # ä¸€é”® Diff ç¤ºä¾‹
â””â”€ data/
   â”œâ”€ runs/<run_id>/raw/{cursor.md|patch.diff|term.log}
   â”œâ”€ runs/<run_id>/events.jsonl | guards.jsonl | artifacts/
   â”œâ”€ patterns/pc_*.json      # å…¨å±€æ¨¡å¼å¡åº“ï¼ˆè·¨ä¼šè¯å¤ç”¨ï¼‰
   â””â”€ profiles/<user>.json    # ç”¨æˆ·ç”»åƒï¼ˆè·¯ç”±ï¼‰
```

---

## ğŸ›¡ï¸ Q1 æ‰§è¡Œç›‘æ§ï¼ˆDrift Guardsï¼‰

- å®ˆå«ï¼šScope / Plan / Test / Evidenceï¼›æƒé‡é»˜è®¤ `0.4/0.3/0.2/0.1`ã€‚
- åŠ¨ä½œé˜ˆå€¼ï¼ˆå¯åœ¨ `goal.json.thresholds` è¦†ç›–ï¼‰ï¼š
  - `drift < 0.5` â†’ `ok`
  - `0.5 â‰¤ drift < 0.8` â†’ `warn`
  - `drift â‰¥ 0.8` â†’ `rollback`
- è®¡åˆ†å¯¹è±¡ï¼š
  - `edit` å‚ä¸ Scope/Plan/Evidenceï¼›
  - `shell(test)` å‚ä¸ Testï¼›
  - `plan` æ°¸è¿œä¸è®¡åˆ†ï¼ˆä»…ç•™ç—•ï¼Œ`action=ok`ï¼‰ã€‚
- è‡ªåŠ¨ä¿®å¤å»ºè®®ï¼šå½“ `rollback` ä¸”è·¯å¾„è¶Šç•Œæ—¶è¾“å‡º `auto_fixable=true` ä¸ `fix_cmd="git checkout -- <file>"`ã€‚

---

## ğŸ§  Q2 è·¨ä¼šè¯å­¦ä¹ ï¼ˆPattern Cardsï¼‰

- æŠ½å–å¯¹è±¡ï¼šæˆåŠŸ/é«˜ä»·å€¼çš„ runï¼›è¾“å…¥ `events.jsonl + guards.jsonl + goal.json (+ cursor.md)`ã€‚
- æ¨¡å¼å¡å­—æ®µï¼ˆæ²»ç†å°±ç»ªï¼‰ï¼š
```
{
  "version": "1.0",
  "pattern_id": "pc_doc_only_change",
  "title": "æ–‡æ¡£/ç¿»è¯‘ç±»å˜æ›´ï¼šåªæ”¹ç™½åå•",
  "triggers": ["documentation-only","translate readme"],
  "steps": ["whitelist README.md/docs/**","forbid requirements.*","run doc_lang_check & whitelist_diff_check"],
  "invariants": ["only whitelisted files changed","language==target"],
  "anti_patterns": ["edit requirements without consent"],
  "eval_examples": ["doc_lang_check","whitelist_diff_check"],
  "views": {"terse": "...", "guided": "..."},
  "provenance": {"source_runs": ["r42","r60"], "created_by": "team", "created_at": "2025-10-25T10:00:00Z"}
}
```
- å¤ç”¨ï¼šä¿å­˜åˆ° `data/patterns/`ï¼Œæ–°ä»»åŠ¡æŒ‰ `objective`/è§¦å‘è¯æ£€ç´¢å¹¶æ³¨å…¥ã€‚

---

## ğŸ›ï¸ Q3 åŠ¨æ€æŠ½è±¡ï¼ˆä¸ªæ€§åŒ–å›å¤ï¼Œé UIï¼‰

- ç›®æ ‡ï¼šé’ˆå¯¹ä¸åŒç”¨æˆ·/ä»»åŠ¡éš¾åº¦ï¼Œè¾“å‡ºä¸åŒæŠ½è±¡å±‚çº§çš„æ–‡æœ¬å›å¤ï¼ˆéå‰ç«¯ï¼‰ã€‚
- ä¸¤æ¡£è§†å›¾ï¼š
  - `terse`ï¼ˆä¸“å®¶é€Ÿè¯»ï¼‰ï¼šè§„åˆ™ + ä¸å˜é‡ï¼Œä¸€å±è¯»å®Œï¼›
  - `guided`ï¼ˆæ–°æ‰‹æ•™å­¦ï¼‰ï¼šæ­¥éª¤ã€ç¤ºä¾‹ã€å‘ç‚¹ã€å¿…è·‘æµ‹è¯•ä¸ä¾‹å¤–æµç¨‹ã€‚
- è·¯ç”±è§„åˆ™ï¼ˆMVPï¼‰ï¼š
  - è‹¥ç”»åƒ `pref` æŒ‡å®š â†’ ç›´æ¥ç”¨ï¼›
  - å¦åˆ™ `self_report=novice` æˆ– `difficulty=high` æˆ– `hist_first_try_success<0.5` â†’ `guided`ï¼›
  - å…¶ä»– â†’ `terse`ã€‚
- äº§ç‰©ï¼š`data/runs/<run_id>/artifacts/view_preview.md`ï¼Œå¯ç›´æ¥ä½œä¸ºç³»ç»Ÿæç¤ºæˆ–å›å¤æ–‡æœ¬ã€‚

---

## ğŸ”„ æ•°æ®æµï¼ˆChat â†’ Events â†’ Guards â†’ Pattern â†’ Viewï¼‰

1) `raw/cursor.md`ï¼ˆæ¨èï¼‰/ `patch.diff`ï¼ˆå…œåº•ï¼‰
2) `chat2events.py` / `patch2events.py` â†’ `events.jsonl`
3) `events2guards.py` â†’ `guards.jsonl`ï¼ˆdrift_score + action + fix_cmdï¼‰
4) `extract_card.py` â†’ `artifacts/pattern.pc_*.json`ï¼ˆå¹¶å¤åˆ¶åˆ° `data/patterns/`ï¼‰
5) `retrieve.py`ï¼ˆæŒ‰ objective/è§¦å‘è¯æ£€ç´¢ï¼‰
6) `render.py`ï¼ˆæŒ‰ç”»åƒè·¯ç”± terse/guidedï¼‰â†’ `artifacts/view_preview.md`

---

## ğŸ§ª è¯„æµ‹ä¸æŒ‡æ ‡

- æœ¬åœ°æŒ‡æ ‡ï¼š
  - Q1ï¼šåèˆªæ£€å‡ºç‡ã€è¯¯æŠ¥ç‡ã€æ¢å¤æ—¶é—´ï¼›
  - Q2ï¼šæ¨¡å¼å¤ç”¨ç‡ã€é¦–è¯•æˆåŠŸç‡ã€å›åˆæ•°/ç”¨æ—¶ï¼›
  - Q3ï¼šè§†å›¾åŒ¹é…åº¦ï¼ˆguided ä¸‹æ–°æ‰‹æ›´ç¨³ï¼‰ã€‚
- SWEâ€‘bench å¯¹é½ï¼šç”Ÿæˆ `data/eval/predictions.jsonl`ï¼Œåœ¨è£…å¥½å®˜æ–¹ harness çš„ç¯å¢ƒä¸­è¿è¡Œè¯„æµ‹ã€‚

---

## ğŸ“ æœ€å° SOPï¼ˆChat-onlyï¼‰

1) å¯¼å‡º Cursor å¯¹è¯ä¸º `data/runs/<run_id>/raw/cursor.md`
2) ç¼–å†™ `data/runs/<run_id>/goal.json`ï¼ˆç™½/é»‘åå•ã€æ£€æŸ¥ç‚¹ã€é˜ˆå€¼ã€å¿…è·‘æµ‹è¯•ï¼‰
3) æ‰§è¡Œï¼š
```bash
python tools/chat2events.py data/runs/<run_id>
python tools/events2guards.py data/runs/<run_id>
# é€šè¿‡åæŠ½å¡å¹¶å¤ç”¨
python scripts/e2e_chat_only.py <run_id> [user]
```

å°æŠ„ï¼ˆåˆ¤åˆ«è¯ï¼‰ï¼š
- editï¼šupdated / changed / edited / created / removed / å·²ä¿®æ”¹ / å·²ç¿»è¯‘ / â€œä»£ç å— + æˆ‘å·²ä¿®æ”¹/ç¿»è¯‘ â€¦â€
- planï¼šå»ºè®® / å°† / è®¡åˆ’ / propose / plan / will / can / å¯ä»¥è€ƒè™‘ â€¦
- testï¼špytest / npm test / go test / mvn test / vitest â€¦

---

## ğŸ“ é™„ï¼šSchema æ‘˜è¦

- events.jsonlï¼ˆå¹¶åˆ—å¹¶é›†ï¼‰
  - editï¼š`{ run_id, step, phase:"modify", tool:"edit", where:"<path>:?", why?, confidence?, evidence? }`
  - planï¼š`{ run_id, step, phase:"modify", tool:"plan", why, confidence? }`
  - shell(test)ï¼š`{ run_id, step, phase:"test"|"regress", tool:"shell", cmd }`
- guards.jsonlï¼š`{ run_id, step, scope_guard, plan_guard, test_guard, evidence_guard, drift_score, action, file?, auto_fixable?, fix_cmd? }`
- patternï¼šè§ä¸Šï¼ˆå« `version/title/provenance`ï¼‰
- profileï¼š`{ user_id, self_report, hist_first_try_success, pref }`

â€”â€”

è‹¥éœ€æ›´å¤šæ¡ˆä¾‹ï¼ˆä¾èµ–ä¿®å¤ã€è¶…æ—¶é‡è¯•ã€æ—¥å¿—é™å™ªç­‰ï¼‰ï¼Œå¯è¡¥å……å¯¹åº”çš„ `goal.json + events.jsonl` fixtures å¹¶çº³å…¥è¯„æµ‹ã€‚
